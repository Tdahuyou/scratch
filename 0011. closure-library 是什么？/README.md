## ğŸ¤– AI - Closure Library æ˜¯ä»€ä¹ˆï¼Ÿ

Closure Library æ˜¯ä¸€ä¸ªç”± Google å¼€å‘çš„å¼ºå¤§çš„ JavaScript åº“ï¼Œå®ƒæä¾›äº†å¤§é‡ç»è¿‡ä¸¥æ ¼æµ‹è¯•ã€æ–‡æ¡£é½å…¨ä¸”ç»“æ„è‰¯å¥½çš„æ¨¡å—åŒ–ä»£ç ã€‚Closure Library çš„è®¾è®¡ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…æ„å»ºå¤æ‚å’Œå¤§è§„æ¨¡çš„ Web åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯ Closure Library çš„ä¸€äº›å…³é”®ç‰¹ç‚¹ï¼š

### ä¸»è¦ç‰¹ç‚¹

1. **æ¨¡å—åŒ–**ï¼šClosure Library é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½è¢«å°è£…æˆç‹¬ç«‹çš„æ¨¡å—ï¼Œè¿™ä½¿å¾—ä½ å¯ä»¥åªåŠ è½½ä½ éœ€è¦çš„éƒ¨åˆ†ï¼Œä»è€Œå‡å°‘é¡µé¢åŠ è½½æ—¶é—´ã€‚
2. **ç±»å‹æ³¨è§£**ï¼šåº“ä¸­çš„å‡½æ•°å’Œæ–¹æ³•éƒ½ä½¿ç”¨äº†ç±»å‹æ³¨è§£ï¼Œè¿™æœ‰åŠ©äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°æ½œåœ¨çš„é”™è¯¯ï¼Œå¹¶ä¸ Google çš„ Closure Compiler é…åˆä½¿ç”¨æ—¶å¯ä»¥è¿›è¡Œæ›´é«˜çº§åˆ«çš„ä¼˜åŒ–ã€‚
3. **ä¸°å¯Œçš„ç»„ä»¶**ï¼šæä¾›äº†å¤§é‡çš„ UI ç»„ä»¶ã€æ•°æ®ç»“æ„ã€ç®—æ³•ã€äº‹ä»¶å¤„ç†ç­‰å·¥å…·ï¼Œå‡ ä¹æ¶µç›–äº† Web å¼€å‘ä¸­å¸¸è§çš„æ‰€æœ‰éœ€æ±‚ã€‚
4. **è·¨æµè§ˆå™¨å…¼å®¹æ€§**ï¼šClosure Library åœ¨å¤šä¸ªä¸»æµæµè§ˆå™¨ä¸Šè¿›è¡Œäº†å¹¿æ³›çš„æµ‹è¯•ï¼Œç¡®ä¿äº†è·¨æµè§ˆå™¨çš„ä¸€è‡´æ€§å’Œå…¼å®¹æ€§ã€‚
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šç»“åˆ Closure Compiler ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å¯¹ä»£ç è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼ŒåŒ…æ‹¬å»é™¤æœªä½¿ç”¨çš„ä»£ç ã€é‡å‘½åå˜é‡ä»¥å‡å°æ–‡ä»¶å¤§å°ç­‰ã€‚
6. **å›½é™…åŒ–æ”¯æŒ**ï¼šæä¾›äº†ä¸€å¥—å®Œæ•´çš„å›½é™…åŒ–ï¼ˆi18nï¼‰å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ è½»æ¾åœ°ä¸ºåº”ç”¨æ·»åŠ å¤šè¯­è¨€æ”¯æŒã€‚
7. **å•å…ƒæµ‹è¯•æ¡†æ¶**ï¼šå†…ç½®äº†ä¸€ä¸ªè½»é‡çº§çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œä¾¿äºå¼€å‘è€…ç¼–å†™å’Œè¿è¡Œæµ‹è¯•ã€‚
8. **ä¾èµ–ç®¡ç†**ï¼šé€šè¿‡ `goog.require` å’Œ `goog.provide` æœºåˆ¶æ¥å£°æ˜å’Œç®¡ç†ä¾èµ–å…³ç³»ï¼Œç®€åŒ–äº†æ¨¡å—é—´çš„å¼•ç”¨ã€‚

### ä½¿ç”¨åœºæ™¯

- **å¤§å‹ Web åº”ç”¨**ï¼šé€‚ç”¨äºéœ€è¦é«˜åº¦å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§çš„å¤§å‹ Web åº”ç”¨ç¨‹åºã€‚
- **ä¼ä¸šçº§é¡¹ç›®**ï¼šå¯¹äºéœ€è¦é•¿æœŸç»´æŠ¤çš„ä¼ä¸šçº§é¡¹ç›®ï¼ŒClosure Library æä¾›äº†ç¨³å®šçš„åŸºç¡€ã€‚
- **æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨**ï¼šå¦‚æœä½ çš„åº”ç”¨å¯¹æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚ï¼ŒClosure Library ä¸ Closure Compiler ç»“åˆä½¿ç”¨å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚

### å¦‚ä½•å¼€å§‹

è¦å¼€å§‹ä½¿ç”¨ Closure Libraryï¼Œä½ éœ€è¦é¦–å…ˆå°†å…¶ä¸‹è½½åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼è·å–ï¼š

- **é€šè¿‡ npm å®‰è£…**ï¼š
  ```bash
  npm install google-closure-library
  ```

- **ä» GitHub å…‹éš†**ï¼š
  ```bash
  git clone https://github.com/google/closure-library.git
  ```

- **ç›´æ¥ä¸‹è½½ ZIP æ–‡ä»¶**ï¼š
  è®¿é—® [Closure Library GitHub é¡µé¢](https://github.com/google/closure-library) å¹¶ä¸‹è½½æœ€æ–°çš„æºç åŒ…ã€‚

ä¸€æ—¦ä½ æœ‰äº† Closure Libraryï¼Œå°±å¯ä»¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£å¼€å§‹å¼•å…¥æ‰€éœ€çš„æ¨¡å—å¹¶å¼€å§‹ç¼–ç äº†ã€‚é€šå¸¸ï¼Œä½ ä¼šä½¿ç”¨ `goog.require` æ¥å¼•å…¥æ¨¡å—ï¼Œä¾‹å¦‚ï¼š

```javascript
goog.require('goog.dom');
goog.require('goog.events');

// ä½¿ç”¨ Closure Library ä¸­çš„åŠŸèƒ½
var element = goog.dom.getElement('myElement');
goog.events.listen(element, 'click', function(e) {
  console.log('Element was clicked!');
});
```

### æ€»ç»“

Closure Library æ˜¯ä¸€ä¸ªéå¸¸å…¨é¢çš„ JavaScript åº“ï¼Œç‰¹åˆ«é€‚åˆäºé‚£äº›éœ€è¦é«˜è´¨é‡ã€é«˜æ€§èƒ½å’Œè‰¯å¥½ç»„ç»‡ç»“æ„çš„ Web åº”ç”¨ã€‚å°½ç®¡å®ƒæœ‰ä¸€å®šçš„å­¦ä¹ æ›²çº¿ï¼Œä½†å¯¹äºå¤§å‹æˆ–é•¿æœŸç»´æŠ¤çš„é¡¹ç›®æ¥è¯´ï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚

## ğŸ¤– è¿™æ˜¯ç”Ÿæˆå‹ç¼©ç‰ˆçš„ä»£ç ç”Ÿæˆå™¨çš„æ„å»ºè„šæœ¬ï¼Œæˆ‘æƒ³è¦çŸ¥é“å¦‚ä½•ä¸å‹ç¼©æ„å»ºï¼Ÿ

```py
  def gen_generator(self):

    target_filename = "generator_compressed_vertical.js"
    filenames = glob.glob(os.path.join("generators", "*.js"))
    # filenames += glob.glob(os.path.join("generators/javascript", "*.js"))
    # filenames += glob.glob(os.path.join("generators/python", "*.js"))
    filenames += glob.glob(os.path.join("generators/clang", "*.js"))

    # glob.glob ordering is platform-dependent and not necessary deterministic
    filenames.sort()  # Deterministic build.

    # Define the parameters for the POST request.
    params = [
      ("compilation_level", "SIMPLE"),
    ]

    params.append(("js_file", os.path.join("build", "gen_generator.js")))

    for filename in filenames:
      # Append filenames as false arguments the step before compiling will
      # either transform them into arguments for local or remote compilation
      params.append(("js_file", filename))

    # Remove Blockly.Blocks to be compatible with Blockly.
    remove = "var Blockly={Generator:{},utils:{}};Blockly.utils.global={};Blockly.utils.string={};"
    self.do_compile(params, target_filename, filenames, remove)
```

---

å¦‚æœä½ æƒ³è¦æ„å»ºä¸€ä¸ªä¸å‹ç¼©çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥è°ƒæ•´ä½ çš„æ„å»ºè„šæœ¬ä»¥é¿å…ä½¿ç”¨å‹ç¼©æ­¥éª¤ã€‚åœ¨ä½ æä¾›çš„ä»£ç ä¸­ï¼Œ`params` åˆ—è¡¨ä¸­çš„ `"compilation_level", "SIMPLE"` å‚æ•°æ˜¯ç”¨æ¥æŒ‡å®š Google Closure Compiler çš„ç¼–è¯‘çº§åˆ«ã€‚`SIMPLE` ç¼–è¯‘çº§åˆ«ä¼šè¿›è¡Œä¸€äº›åŸºæœ¬çš„ä¼˜åŒ–ï¼Œä½†ä¸ä¼šåƒ `ADVANCED` é‚£æ ·è¿›è¡Œæ·±åº¦å‹ç¼©å’Œæ··æ·†ã€‚

è¦ç”Ÿæˆä¸€ä¸ªå®Œå…¨ä¸å‹ç¼©çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥å°†ç¼–è¯‘çº§åˆ«è®¾ç½®ä¸º `WHITESPACE_ONLY` æˆ–è€…å¹²è„†ä¸ä½¿ç”¨ Google Closure Compiler è¿›è¡Œä»»ä½•ç¼–è¯‘ã€‚ä¸‹é¢æ˜¯ä¸¤ç§æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼š

### æ–¹æ³• 1: ä½¿ç”¨ `WHITESPACE_ONLY` ç¼–è¯‘çº§åˆ«

å°†ç¼–è¯‘çº§åˆ«è®¾ç½®ä¸º `WHITESPACE_ONLY` åªä¼šå»é™¤ç©ºç™½å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ï¼‰ï¼Œè€Œä¸ä¼šå¯¹ä»£ç è¿›è¡Œå…¶ä»–å½¢å¼çš„å‹ç¼©æˆ–ä¼˜åŒ–ã€‚

```python
# Define the parameters for the POST request.
params = [
  ("compilation_level", "WHITESPACE_ONLY"),
]

params.append(("js_file", os.path.join("build", "gen_generator.js")))

for filename in filenames:
  # Append filenames as false arguments the step before compiling will
  # either transform them into arguments for local or remote compilation
  params.append(("js_file", filename))

# Remove Blockly.Blocks to be compatible with Blockly.
remove = "var Blockly={Generator:{},utils:{}};Blockly.utils.global={};Blockly.utils.string={};"
self.do_compile(params, target_filename, filenames, remove)
```

### æ–¹æ³• 2: ä¸ä½¿ç”¨ Google Closure Compiler

å¦‚æœä½ å®Œå…¨ä¸æƒ³ä½¿ç”¨ Google Closure Compilerï¼Œä½ å¯ä»¥ç›´æ¥åˆå¹¶æ‰€æœ‰çš„ JavaScript æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸éœ€è¦è°ƒç”¨ `self.do_compile` å‡½æ•°ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•æ‰‹åŠ¨åˆå¹¶æ–‡ä»¶è€Œä¸è¿›è¡Œä»»ä½•å‹ç¼©ï¼š

```python
import os

def gen_generator(self):
    target_filename = "generator_uncompressed_vertical.js"
    filenames = glob.glob(os.path.join("generators", "*.js"))
    # å¦‚æœéœ€è¦åŒ…å«å…¶ä»–ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œ
    # filenames += glob.glob(os.path.join("generators/javascript", "*.js"))
    # filenames += glob.glob(os.path.join("generators/python", "*.js"))
    filenames += glob.glob(os.path.join("generators/clang", "*.js"))

    # ç¡®ä¿æ–‡ä»¶é¡ºåºæ˜¯ç¡®å®šçš„
    filenames.sort()

    # å®šä¹‰ç§»é™¤çš„å†…å®¹
    remove = "var Blockly={Generator:{},utils:{}};Blockly.utils.global={};Blockly.utils.string={};"

    # åˆå¹¶æ–‡ä»¶å†…å®¹
    with open(target_filename, 'w') as outfile:
        for fname in filenames:
            with open(fname) as infile:
                content = infile.read()
                if remove in content:
                    content = content.replace(remove, "")
                outfile.write(content)
                outfile.write("\n")  # æ·»åŠ æ¢è¡Œç¬¦ä»¥ä¿æŒæ¯ä¸ªæ–‡ä»¶çš„ç‹¬ç«‹æ€§

    # å¦‚æœæœ‰å…¶ä»–å¤„ç†é€»è¾‘ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è¯»å–æ‰€æœ‰æŒ‡å®šçš„ JavaScript æ–‡ä»¶å¹¶å°†å®ƒä»¬å†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶ `generator_uncompressed_vertical.js` ä¸­ã€‚å¦‚æœéœ€è¦ç§»é™¤æŸäº›ç‰¹å®šçš„å†…å®¹ï¼ˆå¦‚ `remove` å­—ç¬¦ä¸²ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸€æ­¥è¿›è¡Œæ›¿æ¢ã€‚

è¿™æ ·ç”Ÿæˆçš„æ–‡ä»¶å°†æ˜¯æœªå‹ç¼©çš„ï¼Œå¹¶ä¸”ä¿ç•™äº†åŸå§‹çš„æ ¼å¼å’Œç»“æ„ï¼Œä¾¿äºè°ƒè¯•å’Œé˜…è¯»ã€‚

## ğŸ¤– compilation_level éƒ½æœ‰å“ªäº›å¯é€‰å€¼ï¼Ÿ

Google Closure Compiler æä¾›äº†å‡ ç§ä¸åŒçš„ç¼–è¯‘çº§åˆ«ï¼Œæ¯ç§çº§åˆ«æä¾›äº†ä¸åŒç¨‹åº¦çš„ä»£ç ä¼˜åŒ–ã€‚è¿™äº›ç¼–è¯‘çº§åˆ«å¯ä»¥é€šè¿‡ `compilation_level` å‚æ•°æ¥æŒ‡å®šã€‚ä»¥ä¸‹æ˜¯å¯ç”¨çš„ç¼–è¯‘çº§åˆ«åŠå…¶ç‰¹ç‚¹ï¼š

1. **WHITESPACE_ONLY**ï¼š
   - ä»…ç§»é™¤ç©ºç™½å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰ã€‚
   - ä¸è¿›è¡Œä»»ä½•å…¶ä»–å½¢å¼çš„ä»£ç ä¼˜åŒ–æˆ–å‹ç¼©ã€‚
   - é€‚ç”¨äºéœ€è¦ä¿æŒä»£ç å¯è¯»æ€§çš„æƒ…å†µã€‚
2. **SIMPLE_OPTIMIZATIONS**ï¼š
   - è¿›è¡ŒåŸºæœ¬çš„ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ç§»é™¤æœªä½¿ç”¨çš„å˜é‡å’Œå‡½æ•°ã€ç®€åŒ–è¡¨è¾¾å¼ç­‰ã€‚
   - ä»£ç ä»ç„¶ä¿æŒä¸€å®šç¨‹åº¦çš„å¯è¯»æ€§ï¼Œä½†ä¼šæœ‰ä¸€äº›å°çš„æ”¹åŠ¨ã€‚
   - é€‚ç”¨äºå¸Œæœ›å‡å°‘æ–‡ä»¶å¤§å°ä½†ä¸å¸Œæœ›ä»£ç å®Œå…¨æ··æ·†çš„æƒ…å†µã€‚
3. **ADVANCED_OPTIMIZATIONS**ï¼š
   - è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é‡å‘½åå±€éƒ¨å˜é‡å’Œå‡½æ•°ã€å†…è”å‡½æ•°ã€ç§»é™¤æ­»ä»£ç ç­‰ã€‚
   - ä»£ç ä¼šè¢«é«˜åº¦å‹ç¼©å’Œæ··æ·†ï¼Œå˜å¾—éš¾ä»¥é˜…è¯»ã€‚
   - é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥æ˜¾è‘—å‡å°æ–‡ä»¶å¤§å°å¹¶æé«˜åŠ è½½é€Ÿåº¦ã€‚
   - éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨æ­¤çº§åˆ«çš„ä¼˜åŒ–æ—¶ï¼Œä»£ç ä¸­çš„æŸäº›å‡è®¾ï¼ˆå¦‚å…¨å±€å˜é‡çš„åç§°ï¼‰å¯èƒ½ä¼šè¢«ç ´åï¼Œå› æ­¤éœ€è¦ç¡®ä¿ä»£ç ç¬¦åˆé—­åŒ…ç¼–è¯‘å™¨çš„è¦æ±‚ã€‚

### ä½¿ç”¨ç¤ºä¾‹

åœ¨ä½ çš„æ„å»ºè„šæœ¬ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„ç¼–è¯‘çº§åˆ«ã€‚ä¾‹å¦‚ï¼š

```python
# å®šä¹‰ POST è¯·æ±‚çš„å‚æ•°
params = [
  ("compilation_level", "WHITESPACE_ONLY"),  # æˆ–è€… "SIMPLE_OPTIMIZATIONS" æˆ– "ADVANCED_OPTIMIZATIONS"
]

params.append(("js_file", os.path.join("build", "gen_generator.js")))

for filename in filenames:
  # æ·»åŠ æ–‡ä»¶åä½œä¸ºå‚æ•°
  params.append(("js_file", filename))

# ç§»é™¤ Blockly.Blocks ä»¥å…¼å®¹ Blockly
remove = "var Blockly={Generator:{},utils:{}};Blockly.utils.global={};Blockly.utils.string={};"
self.do_compile(params, target_filename, filenames, remove)
```

### é€‰æ‹©åˆé€‚çš„ç¼–è¯‘çº§åˆ«

- **å¼€å‘é˜¶æ®µ**ï¼šé€šå¸¸ä½¿ç”¨ `WHITESPACE_ONLY` æˆ– `SIMPLE_OPTIMIZATIONS`ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ä¿æŒä»£ç çš„å¯è¯»æ€§ï¼Œä¾¿äºè°ƒè¯•ã€‚
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ `ADVANCED_OPTIMIZATIONS` å¯ä»¥æ˜¾è‘—å‡å°æ–‡ä»¶å¤§å°å¹¶æé«˜æ€§èƒ½ï¼Œä½†éœ€è¦æ³¨æ„ä»£ç å¯èƒ½å˜å¾—éš¾ä»¥é˜…è¯»ï¼Œå¹¶ä¸”éœ€è¦ç¡®ä¿ä»£ç ç¬¦åˆé—­åŒ…ç¼–è¯‘å™¨çš„è¦æ±‚ã€‚

### æ³¨æ„äº‹é¡¹

- **ä»£ç è§„èŒƒ**ï¼šä½¿ç”¨ `ADVANCED_OPTIMIZATIONS` æ—¶ï¼Œå¿…é¡»éµå¾ªç‰¹å®šçš„ç¼–ç è§„èŒƒï¼Œä»¥é¿å…æ½œåœ¨çš„é—®é¢˜ï¼Œä¾‹å¦‚æ­£ç¡®å¤„ç†å¤–éƒ¨ä¾èµ–ã€é¿å…å…¨å±€å˜é‡æ±¡æŸ“ç­‰ã€‚
- **æµ‹è¯•**ï¼šæ— è®ºé€‰æ‹©å“ªç§ç¼–è¯‘çº§åˆ«ï¼Œåœ¨å‘å¸ƒå‰éƒ½åº”è¯¥å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œå…¨é¢çš„æµ‹è¯•ï¼Œä»¥ç¡®ä¿åŠŸèƒ½æ­£å¸¸ã€‚

é€šè¿‡é€‰æ‹©åˆé€‚çš„ç¼–è¯‘çº§åˆ«ï¼Œä½ å¯ä»¥å¹³è¡¡ä»£ç çš„å¯è¯»æ€§å’Œæ€§èƒ½ï¼Œä»¥æ»¡è¶³ä¸åŒé˜¶æ®µçš„éœ€æ±‚ã€‚

## ğŸ¤–
